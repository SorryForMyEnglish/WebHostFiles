# Телеграм‑бот хранения файлов

Небольшой бот на Go для платного хранения документов пользователей. Все данные сохраняются в SQLite, а файлы выдаются через встроенный HTTP/HTTPS сервер.

## Возможности

- приём файлов от пользователей;
- простое управление через клавиатуру в чате;
- ограничение размера загружаемого файла с возможностью доплаты за объём;
- уведомления о скачивании файлов;
- поддержка оплаты через **CryptoBot** и **xRocket** (USDT).

## Сборка и запуск

```bash
go build -o filestorage ./cmd
```

Первый запуск создаст файл `config.yml` с базовыми настройками. Заполните токены и при необходимости измените остальные параметры.

Запуск бота:

```bash
./filestorage
```

При задании сертификатов `tls_cert` и `tls_key` сервер будет работать по HTTPS. Для HTTP достаточно указать `http_address`.

## Настройка

В конфигурации доступны следующие основные поля:

| Параметр | Описание |
|---------|----------|
| `telegram_token` | токен Telegram‑бота |
| `cryptobot_token` | токен CryptoBot |
| `xrocket_token` | токен xRocket |
| `cryptobot_min_topup` | минимальное пополнение через CryptoBot (по умолчанию 0.1 USDT) |
| `xrocket_min_topup` | минимальное пополнение через xRocket (по умолчанию 0.1 USDT) |
| `database_path` | путь к базе данных (по умолчанию `filestorage.db`) |
| `file_storage_path` | директория для сохранения файлов |
| `max_file_size` | максимальный размер загружаемого файла |
| `domain` | базовый URL для формирования ссылок |
| `http_address` | адрес встроенного сервера |
| `tls_cert`, `tls_key` | сертификат и ключ для HTTPS |
| `admin_id` | Telegram ID администратора |
| `price_upload` | стоимость загрузки файла |
| `price_refund` | возврат при удалении файла |

Максимальная сумма пополнения устанавливается по умолчанию и составляет **10000** USDT. В конфиге её задавать не требуется.

Чтобы принимать оплату, укажите соответствующие токены. При отсутствии токена провайдер будет отключён.

## Проверка оплаты

Для проверки статуса счёта в CryptoBot используется POST‑запрос к `getInvoices`. Если статус счёта `paid`, средства поступят на баланс пользователя.

## Лицензия

Проект распространяется под лицензией MIT.
